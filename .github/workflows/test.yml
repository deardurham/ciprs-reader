name: Lint and Test code

on:
  pull_request:
  schedule:
    # run once a week on early monday mornings
    - cron: '22 2 * * 1'

jobs:
  test:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.8'
      - name: Build docker images
        run: docker build -t ciprs-reader .
      - uses: pre-commit/action@v2.0.0
      - name: Run Pre-commit
        run: docker run --rm -t -v "${PWD}:/usr/src/app" ciprs-reader pre-commit
      - name: Run Tests
        run: docker run --rm -t -v "${PWD}:/usr/src/app" ciprs-reader pytest
